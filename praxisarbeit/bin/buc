#!/bin/bash 

cwd=`pwd`
cd `dirname $0`	
BINDIR=`pwd`
cd $cwd	
BASENAME=`basename $0`
LOGDIR=$BINDIR/../var
ETCDIR=$BINDIR/../etc

usage() {
	echo "usage: $BASENAME [-phv] [path to user file]"
}

source $ETCDIR/bucb.env

while getopts p:h:v: optvar; do
	case $optvar in
		p) DEFAULT_PASSWORD=${OPTARG} ;;
		h) echo "!!" ;;
		v) input_file=${OPTARG} && echo "!!: ${OPTARG}" ;;
		*) usage && exit 1 ;;
	esac
done

echo "$DEFAULT_PASSWORD"

cat $1 | while read username groupname name_first name_last ; do
	if [ ! $(getent group "$groupname") ]; then
		addgroup $groupname
		echo "[WARNING] Group $groupname does not exist!"
	fi
	useradd "$username" -c "$name_first $name_last" -G "$groupname" -p "$(openssl passwd -1 $DEFAULT_PASSWORD)"
	#echo "Adding user $name_first $name_last as $username, member of $groupname" >> $LOGDIR/buc.log
	# TODO: Replace with a log function

done

